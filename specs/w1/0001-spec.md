# Project Alpha - 需求与设计文档

## 1. 项目概述

### 1.1 项目简介
Project Alpha 是一个基于标签的 Ticket 管理工具，帮助用户通过标签分类和管理任务。系统采用前后端分离架构，无需用户认证系统，提供简洁高效的任务管理体验。

### 1.2 技术栈
- **后端**: 
  - Rust 1.85+
  - Axum 0.8+
  - SQLx 0.8+
  - Tokio 1.40+ (异步运行时)
  - Serde 1.0+ (序列化)
  - Chrono 0.4+ (时间处理)
  - UUID 1.10+ (UUID 生成)
- **前端**: 
  - TypeScript 5.6+
  - React 19.2+
  - Vite 7.2+
  - Tailwind CSS 4.1+
  - Shadcn UI 0.4+
  - Zustand 5.0+ (状态管理)
  - React Router 7.1+ (路由)
  - Axios 1.7+ (HTTP 客户端)
  - React Hook Form 7.54+ (表单处理)
  - Zod 3.24+ (数据验证)
- **数据库**: PostgreSQL 16+

### 1.3 核心功能
- Ticket 的创建、编辑、删除、完成/取消完成
- Ticket 标签的添加和删除
- 按标签筛选 Ticket 列表
- 按标题模糊搜索 Ticket

## 2. 功能需求

### 2.1 Ticket 管理

#### 2.1.1 创建 Ticket
- **功能描述**: 用户可以创建新的 Ticket
- **输入要求**:
  - 标题（必填，字符串，最大长度 255）
  - 描述（可选，文本）
  - 标签（可选，可多选）
- **业务规则**:
  - 创建时默认状态为未完成
  - 自动记录创建时间

#### 2.1.2 编辑 Ticket
- **功能描述**: 用户可以修改 Ticket 的标题、描述和完成状态
- **输入要求**:
  - 标题（可选）
  - 描述（可选）
  - 完成状态（可选，布尔值）
- **业务规则**:
  - 至少提供一个字段进行更新
  - 在应用程序中显式更新 `updated_at` 字段为当前时间

#### 2.1.3 删除 Ticket
- **功能描述**: 用户可以删除 Ticket
- **业务规则**:
  - 删除 Ticket 时自动删除所有关联的标签关系
  - 删除操作不可恢复

#### 2.1.4 完成/取消完成 Ticket
- **功能描述**: 用户可以切换 Ticket 的完成状态
- **业务规则**:
  - 提供快速切换完成状态的接口
  - 在应用程序中显式更新 `updated_at` 字段为当前时间

### 2.2 标签管理

#### 2.2.1 创建标签
- **功能描述**: 用户可以创建新的标签
- **输入要求**:
  - 名称（必填，字符串，最大长度 50，唯一）
  - 颜色（可选，十六进制颜色代码，如 #ff0000）
- **业务规则**:
  - 标签名称必须唯一
  - 自动记录创建时间

#### 2.2.2 编辑标签
- **功能描述**: 用户可以修改标签的名称和颜色
- **输入要求**:
  - 名称（可选）
  - 颜色（可选）
- **业务规则**:
  - 修改名称时需保持唯一性
  - 至少提供一个字段进行更新

#### 2.2.3 删除标签
- **功能描述**: 用户可以删除标签
- **业务规则**:
  - 删除标签时自动删除所有 Ticket 与该标签的关联关系
  - 删除操作不可恢复

### 2.3 Ticket 标签关联

#### 2.3.1 添加标签到 Ticket
- **功能描述**: 用户可以为 Ticket 添加标签
- **输入要求**:
  - Ticket ID
  - 标签 ID
- **业务规则**:
  - 一个 Ticket 可以有多个标签
  - 一个标签可以关联多个 Ticket
  - 重复添加同一标签不会报错（幂等操作）

#### 2.3.2 从 Ticket 移除标签
- **功能描述**: 用户可以从 Ticket 移除标签
- **输入要求**:
  - Ticket ID
  - 标签 ID
- **业务规则**:
  - 移除不存在的关联不会报错（幂等操作）

### 2.4 查询与筛选

#### 2.4.1 获取 Ticket 列表
- **功能描述**: 用户可以获取 Ticket 列表
- **查询参数**:
  - `tag`: 按标签 ID 筛选（可选）
  - `search`: 按标题模糊搜索（可选）
  - `completed`: 按完成状态筛选（可选，布尔值）
- **返回数据**:
  - Ticket 列表（包含关联的标签信息）
  - 按创建时间倒序排列

#### 2.4.2 获取单个 Ticket
- **功能描述**: 用户可以获取单个 Ticket 的详细信息
- **返回数据**:
  - Ticket 完整信息（包含所有关联的标签）

#### 2.4.3 获取标签列表
- **功能描述**: 用户可以获取所有标签列表
- **返回数据**:
  - 标签列表（按名称排序）

#### 2.4.4 获取单个标签
- **功能描述**: 用户可以获取单个标签的详细信息
- **返回数据**:
  - 标签完整信息

## 3. 数据模型

### 3.1 Ticket（票据）

```rust
use chrono::{DateTime, Utc};
use uuid::Uuid;

pub struct Ticket {
    pub id: Uuid,
    pub title: String,                    // 必填，最大长度 255
    pub description: Option<String>,      // 可选，文本类型
    pub completed: bool,                   // 完成状态，默认 false
    pub created_at: DateTime<Utc>,        // 创建时间
    pub updated_at: DateTime<Utc>,        // 更新时间
}

pub struct TicketWithTags {
    pub ticket: Ticket,
    pub tags: Vec<Tag>,                   // 关联的标签列表
}

pub struct CreateTicketRequest {
    pub title: String,
    pub description: Option<String>,
    pub tag_ids: Option<Vec<Uuid>>,
}

pub struct UpdateTicketRequest {
    pub title: Option<String>,
    pub description: Option<String>,
    pub completed: Option<bool>,
}
```

### 3.2 Tag（标签）

```rust
use chrono::{DateTime, Utc};
use uuid::Uuid;

pub struct Tag {
    pub id: Uuid,
    pub name: String,                      // 必填，最大长度 50，唯一
    pub color: Option<String>,            // 可选，十六进制颜色代码（如 "#ff0000"）
    pub created_at: DateTime<Utc>,        // 创建时间
}

pub struct CreateTagRequest {
    pub name: String,
    pub color: Option<String>,
}

pub struct UpdateTagRequest {
    pub name: Option<String>,
    pub color: Option<String>,
}
```

### 3.3 TicketTag（关联表）

```rust
use uuid::Uuid;

pub struct TicketTag {
    pub ticket_id: Uuid,                   // Ticket ID，外键
    pub tag_id: Uuid,                     // Tag ID，外键
    // 复合主键 (ticket_id, tag_id)
}
```

## 4. API 接口设计

### 4.1 Ticket API

#### 4.1.1 获取 Ticket 列表
```
GET /api/tickets
查询参数:
  - tag?: string          // 标签 ID
  - search?: string       // 搜索关键词
  - completed?: boolean   // 完成状态

响应: Ticket[]
```

#### 4.1.2 获取单个 Ticket
```
GET /api/tickets/:id

响应: Ticket
```

#### 4.1.3 创建 Ticket
```
POST /api/tickets
请求体:
  {
    title: string;
    description?: string;
    tagIds?: string[];
  }

响应: Ticket (201 Created)
```

#### 4.1.4 更新 Ticket
```
PUT /api/tickets/:id
请求体:
  {
    title?: string;
    description?: string;
    completed?: boolean;
  }

响应: Ticket (200 OK)
```

#### 4.1.5 删除 Ticket
```
DELETE /api/tickets/:id

响应: 204 No Content
```

#### 4.1.6 切换完成状态
```
PATCH /api/tickets/:id/toggle

响应: Ticket (200 OK)
```

#### 4.1.7 添加标签到 Ticket
```
POST /api/tickets/:ticketId/tags/:tagId

响应: 204 No Content
```

#### 4.1.8 从 Ticket 移除标签
```
DELETE /api/tickets/:ticketId/tags/:tagId

响应: 204 No Content
```

### 4.2 Tag API

#### 4.2.1 获取标签列表
```
GET /api/tags

响应: Tag[]
```

#### 4.2.2 获取单个标签
```
GET /api/tags/:id

响应: Tag
```

#### 4.2.3 创建标签
```
POST /api/tags
请求体:
  {
    name: string;
    color?: string;
  }

响应: Tag (201 Created)
```

#### 4.2.4 更新标签
```
PUT /api/tags/:id
请求体:
  {
    name?: string;
    color?: string;
  }

响应: Tag (200 OK)
```

#### 4.2.5 删除标签
```
DELETE /api/tags/:id

响应: 204 No Content
```

## 5. 数据库设计

### 5.1 表结构

#### 5.1.1 tickets 表
```sql
CREATE TABLE tickets (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(255) NOT NULL,
  description TEXT,
  completed BOOLEAN NOT NULL DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);
```

#### 5.1.2 tags 表
```sql
CREATE TABLE tags (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(50) NOT NULL UNIQUE,
  color VARCHAR(7),
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);
```

#### 5.1.3 ticket_tags 关联表
```sql
CREATE TABLE ticket_tags (
  ticket_id UUID NOT NULL REFERENCES tickets(id) ON DELETE CASCADE,
  tag_id UUID NOT NULL REFERENCES tags(id) ON DELETE CASCADE,
  PRIMARY KEY (ticket_id, tag_id)
);
```

### 5.2 索引设计

```sql
-- Ticket 标题搜索索引（使用 GIN 索引支持模糊搜索）
CREATE INDEX idx_tickets_title_gin ON tickets USING gin(title gin_trgm_ops);

-- Ticket-Tag 关联索引
CREATE INDEX idx_ticket_tags_ticket_id ON ticket_tags(ticket_id);
CREATE INDEX idx_ticket_tags_tag_id ON ticket_tags(tag_id);
```

### 5.3 时间戳更新策略

**注意**: 不使用数据库触发器自动更新 `updated_at` 字段。

- **创建记录时**: 在应用程序中同时设置 `created_at` 和 `updated_at` 为当前时间
- **更新记录时**: 在应用程序中显式更新 `updated_at` 字段为当前时间
- **实现方式**: 在 Rust 后端代码中，使用 `chrono::Utc::now()` 获取当前时间并更新字段

## 6. 前端界面设计

### 6.1 页面结构

#### 6.1.1 主页面（Ticket 列表页）
- **布局**: 侧边栏 + 主内容区
- **侧边栏**:
  - 标签列表（可点击筛选）
  - 创建标签按钮
- **主内容区**:
  - 搜索栏（标题搜索）
  - 筛选栏（完成状态筛选）
  - Ticket 列表（卡片形式展示）
  - 创建 Ticket 按钮

#### 6.1.2 Ticket 详情/编辑页
- **功能**: 查看和编辑 Ticket 详情
- **内容**:
  - 标题编辑
  - 描述编辑
  - 完成状态切换
  - 标签管理（添加/删除）
  - 保存/取消按钮

### 6.2 组件设计

#### 6.2.1 TicketCard（Ticket 卡片）
- **显示内容**:
  - 标题
  - 描述（可选）
  - 标签列表（带颜色显示）
  - 完成状态指示器
  - 操作按钮（编辑、删除、切换完成状态）

#### 6.2.2 TagBadge（标签徽章）
- **显示内容**:
  - 标签名称
  - 标签颜色（背景色或边框色）

#### 6.2.3 TicketForm（Ticket 表单）
- **表单字段**:
  - 标题输入框（必填）
  - 描述文本域（可选）
  - 标签选择器（多选）
  - 完成状态开关（可选）

#### 6.2.4 TagManager（标签管理器）
- **功能**:
  - 标签列表展示
  - 创建标签
  - 编辑标签
  - 删除标签

#### 6.2.5 SearchBar（搜索栏）
- **功能**:
  - 标题关键词输入
  - 实时搜索（防抖处理）

#### 6.2.6 FilterPanel（筛选面板）
- **功能**:
  - 完成状态筛选（全部/已完成/未完成）
  - 标签筛选（单选）

## 7. 用户体验设计

### 7.1 交互流程

#### 7.1.1 创建 Ticket
1. 点击"创建 Ticket"按钮
2. 弹出表单对话框
3. 填写标题（必填）
4. 可选填写描述
5. 可选选择标签
6. 点击保存
7. 列表自动刷新，新 Ticket 显示在顶部

#### 7.1.2 编辑 Ticket
1. 点击 Ticket 卡片或编辑按钮
2. 打开编辑表单
3. 修改字段
4. 点击保存
5. 列表自动更新

#### 7.1.3 筛选 Ticket
1. 在侧边栏点击标签
2. 主内容区显示该标签下的所有 Ticket
3. 可结合搜索和完成状态筛选

#### 7.1.4 搜索 Ticket
1. 在搜索栏输入关键词
2. 实时显示匹配结果（防抖 300ms）
3. 可结合标签和完成状态筛选

### 7.2 视觉设计

#### 7.2.1 颜色方案
- **主色调**: 蓝色系（专业、可信）
- **完成状态**: 绿色（已完成）、灰色（未完成）
- **标签颜色**: 用户自定义，支持十六进制颜色代码

#### 7.2.2 布局原则
- **响应式设计**: 支持桌面和移动端
- **侧边栏**: 可折叠，默认展开
- **卡片布局**: Ticket 以卡片形式展示，清晰易读

#### 7.2.3 交互反馈
- **加载状态**: 显示加载指示器
- **错误提示**: 友好的错误消息
- **成功反馈**: 操作成功后的提示（Toast）

## 8. 错误处理

### 8.1 错误类型

#### 8.1.1 客户端错误（4xx）
- **400 Bad Request**: 请求参数错误
- **404 Not Found**: 资源不存在
- **409 Conflict**: 资源冲突（如标签名称重复）

#### 8.1.2 服务器错误（5xx）
- **500 Internal Server Error**: 服务器内部错误

### 8.2 错误响应格式

```rust
pub struct ErrorResponse {
    pub error: String,      // 错误消息
    pub status: u16,        // HTTP 状态码
}
```

## 9. 性能要求

### 9.1 响应时间
- API 响应时间 < 200ms（正常情况）
- 列表加载时间 < 500ms（100 条数据以内）

### 9.2 并发支持
- 支持多用户同时操作
- 数据库连接池管理

### 9.3 搜索性能
- 使用 PostgreSQL 的 trigram 扩展支持模糊搜索
- 搜索响应时间 < 300ms

## 10. 安全考虑

### 10.1 输入验证
- 所有用户输入进行验证和清理
- 防止 SQL 注入（使用参数化查询）
- 防止 XSS 攻击（前端转义）

### 10.2 数据完整性
- 使用数据库外键约束
- 级联删除保证数据一致性

## 11. 部署要求

### 11.1 环境配置
- **开发环境**: 本地开发服务器
- **生产环境**: 可部署到云服务器

### 11.2 配置管理
- 使用环境变量管理配置
- 数据库连接字符串
- API 基础 URL

## 12. 未来扩展（可选）

### 12.1 功能扩展
- 用户认证系统
- Ticket 优先级
- Ticket 截止日期
- Ticket 评论功能
- Ticket 附件上传
- 数据导出功能

### 12.2 技术优化
- 前端状态持久化
- 离线支持（PWA）
- 实时更新（WebSocket）
- 移动端应用
