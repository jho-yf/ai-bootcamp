<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数据库查询工具 - 测试环境</title>
  <style>
    body {
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="module">
    // Mock Tauri API before React app loads
    if (!window.__TAURI__) {
      window.__TAURI__ = {
        core: {
          invoke: async (cmd, args) => {
            console.log('[Mock Tauri] invoke:', cmd, args);

            // Mock responses
            const mocks = {
              list_databases: () => [
                {
                  id: 'test-db-1',
                  name: '测试数据库',
                  host: 'localhost',
                  port: 5432,
                  databaseName: 'testdb',
                  user: 'testuser',
                  status: 'connected',
                  createdAt: new Date().toISOString(),
                  updatedAt: new Date().toISOString(),
                },
              ],
              test_connection: () => true,
              add_database: (args) => ({
                id: 'test-db-new',
                name: args?.name || '新数据库',
                host: args?.host || 'localhost',
                port: args?.port || 5432,
                databaseName: args?.databaseName || 'testdb',
                user: args?.user || 'testuser',
                status: 'connected',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
              }),
              get_database_metadata: (args) => ({
                connectionId: args?.databaseId || 'test-db-1',
                tables: [
                  {
                    schema: 'public',
                    name: 'users',
                    tableType: 'BASE TABLE',
                    columns: [
                      {
                        name: 'id',
                        dataType: 'integer',
                        nullable: false,
                        isPrimaryKey: true,
                        ordinalPosition: 1,
                      },
                      {
                        name: 'name',
                        dataType: 'character varying',
                        nullable: false,
                        isPrimaryKey: false,
                        ordinalPosition: 2,
                      },
                    ],
                    primaryKeys: ['id'],
                    foreignKeys: [],
                  },
                ],
                views: [],
                extractedAt: new Date().toISOString(),
              }),
              run_sql_query: (args) => ({
                columns: ['id', 'name'],
                rows: [
                  { id: 1, name: 'Alice' },
                  { id: 2, name: 'Bob' },
                ],
                total: 2,
                execTimeMs: 45,
                sql: args?.sql || 'SELECT * FROM users',
                truncated: false,
              }),
            };

            const handler = mocks[cmd];
            if (handler) {
              return handler(args);
            }

            console.warn('[Mock Tauri] Unknown command:', cmd);
            return null;
          },
        },
      };
    }

    // Import and render the app
    import('/src/main.tsx');
  </script>
</body>
</html>
