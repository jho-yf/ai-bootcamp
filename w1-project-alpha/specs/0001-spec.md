# Project Alpha - Ticket 管理工具需求与设计文档

## 1. 项目概述

### 1.1 项目简介

Project Alpha 是一个简单的基于标签分类和管理 ticket 的工具。该系统不需要用户认证系统，专注于提供高效的 ticket 管理功能。

### 1.2 技术栈

#### 后端技术栈

- **语言**: Rust 1.70+
- **Web 框架**: Axum 0.7
- **异步运行时**: Tokio 1.35
- **数据库 ORM**: SQLx 0.7
- **序列化**: Serde 1.0
- **错误处理**: thiserror 1.0
- **日志**: tracing 0.1
- **数据库**: PostgreSQL 15+

#### 前端技术栈

- **语言**: TypeScript 5.0+
- **构建工具**: Vite 5.0
- **UI 框架**: React 18.2
- **状态管理**: Zustand 4.4
- **样式**: Tailwind CSS 3.3
- **UI 组件库**: Shadcn UI 0.4
- **HTTP 客户端**: Axios 1.6
- **路由**: React Router 6.8

## 2. 功能需求

### 2.1 Ticket 核心功能

- **创建 Ticket**: 用户可以创建新的 ticket，包含标题、描述和初始标签
- **编辑 Ticket**: 用户可以修改已存在 ticket 的标题和描述
- **删除 Ticket**: 用户可以删除不需要的 ticket
- **完成/取消完成 Ticket**: 用户可以标记 ticket 为已完成或未完成状态
- **查看 Ticket 列表**: 用户可以查看所有 ticket 的列表

### 2.2 标签管理功能

- **添加标签**: 用户可以为 ticket 添加多个标签
- **删除标签**: 用户可以从 ticket 中移除标签
- **按标签筛选**: 用户可以按照特定标签查看相关的 ticket 列表

### 2.3 搜索功能

- **标题模糊搜索**: 用户可以通过输入关键词搜索 ticket 标题

## 3. 系统设计

### 3.1 数据库设计

#### 3.1.1 表结构设计

**tickets 表**
| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | UUID | PRIMARY KEY | Ticket 唯一标识 |
| title | VARCHAR(255) | NOT NULL | Ticket 标题 |
| description | TEXT | | Ticket 描述 |
| completed | BOOLEAN | NOT NULL DEFAULT FALSE | 完成状态 |
| created_at | TIMESTAMP | NOT NULL DEFAULT NOW() | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL DEFAULT NOW() | 更新时间 |

**tags 表**
| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | UUID | PRIMARY KEY | 标签唯一标识 |
| name | VARCHAR(50) | NOT NULL UNIQUE | 标签名称 |
| color | VARCHAR(7) | | 标签颜色（十六进制） |
| created_at | TIMESTAMP | NOT NULL DEFAULT NOW() | 创建时间 |

**ticket_tags 表**
| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| ticket_id | UUID | FOREIGN KEY (tickets.id) | 关联的 ticket ID |
| tag_id | UUID | FOREIGN KEY (tags.id) | 关联的标签 ID |
| PRIMARY KEY (ticket_id, tag_id) | | | 复合主键 |

#### 3.1.2 数据库索引

- 在 tickets.title 上创建 GIN 索引以支持模糊搜索
- 在 ticket_tags.ticket_id 和 ticket_tags.tag_id 上创建索引以加速关联查询

### 3.2 API 设计

#### 3.2.1 Ticket 相关 API

**获取所有 Tickets**

```
GET /api/tickets
查询参数:
- tag: 可选，按标签筛选
- search: 可选，标题搜索关键词
- completed: 可选，按完成状态筛选 (true/false)
```

**获取单个 Ticket**

```
GET /api/tickets/{id}
```

**创建 Ticket**

```
POST /api/tickets
请求体:
{
  "title": "string",
  "description": "string",
  "tag_ids": ["uuid"] // 可选
}
```

**更新 Ticket**

```
PUT /api/tickets/{id}
请求体:
{
  "title": "string",
  "description": "string",
  "completed": boolean
}
```

**删除 Ticket**

```
DELETE /api/tickets/{id}
```

**切换 Ticket 完成状态**

```
PATCH /api/tickets/{id}/toggle
```

#### 3.2.2 标签相关 API

**获取所有标签**

```
GET /api/tags
```

**创建标签**

```
POST /api/tags
请求体:
{
  "name": "string",
  "color": "string" // 可选，十六进制颜色值
}
```

**更新标签**

```
PUT /api/tags/{id}
请求体:
{
  "name": "string",
  "color": "string"
}
```

**删除标签**

```
DELETE /api/tags/{id}
```

#### 3.2.3 Ticket-标签关联 API

**为 Ticket 添加标签**

```
POST /api/tickets/{id}/tags
请求体:
{
  "tag_id": "uuid"
}
```

**从 Ticket 移除标签**

```
DELETE /api/tickets/{id}/tags/{tag_id}
```

### 3.3 前端设计

#### 3.3.1 页面结构

- **主页面**: 显示 ticket 列表，包含搜索和筛选功能
- **Ticket 详情页**: 显示单个 ticket 的详细信息，支持编辑
- **标签管理页**: 管理所有标签

#### 3.3.2 组件设计

- **TicketCard**: 显示单个 ticket 的卡片组件
- **TicketList**: ticket 列表组件
- **TicketForm**: 创建/编辑 ticket 的表单组件
- **TagSelector**: 标签选择器组件
- **TagManager**: 标签管理组件
- **SearchBar**: 搜索栏组件
- **FilterPanel**: 筛选面板组件

#### 3.3.3 状态管理

使用 Zustand 4.4 进行全局状态管理，定义以下 store：

- ticketsStore: 管理 ticket 数据及相关操作
- tagsStore: 管理标签数据及相关操作
- uiStore: 管理筛选条件、搜索关键词和 UI 状态

### 3.4 后端架构设计

#### 3.4.1 项目结构

```
src/
├── main.rs              # 应用入口
├── config/              # 配置模块
├── models/              # 数据模型
├── handlers/            # API 处理器
├── services/            # 业务逻辑
├── repositories/        # 数据访问层
└── utils/               # 工具函数
```

#### 3.4.2 依赖库

基于技术栈选择，后端主要依赖库及版本：

- **Web 框架**: axum 0.7
- **ORM**: sqlx 0.7 (PostgreSQL 特性)
- **序列化**: serde 1.0 (包含 serde_json)
- **异步运行时**: tokio 1.35 (完整特性)
- **错误处理**: thiserror 1.0
- **日志**: tracing 0.1 (包含 tracing-subscriber)
- **UUID**: uuid 1.6 (v4 特性)
- **时间处理**: chrono 0.4
- **环境配置**: dotenvy 0.15

#### 3.4.3 错误处理

定义统一的错误类型，处理:

- 数据库错误
- 验证错误
- 资源未找到错误
- 内部服务器错误

## 4. 实现计划

### 4.1 第一阶段：基础架构

1. 设置项目结构
2. 配置数据库连接
3. 实现基础的数据模型
4. 设置基础的 API 路由

### 4.2 第二阶段：核心功能

1. 实现 Ticket CRUD API
2. 实现标签管理 API
3. 实现搜索和筛选功能
4. 前端基础组件开发

### 4.3 第三阶段：集成与优化

1. 前后端集成
2. UI/UX 优化
3. 错误处理完善
4. 性能优化

## 5. 非功能性需求

### 5.1 性能要求

- 页面加载时间 < 2 秒
- API 响应时间 < 500ms
- 支持至少 1000 个 ticket 的流畅操作

### 5.2 可用性要求

- 界面响应式设计，支持桌面和移动设备
- 直观的用户界面，无需学习即可使用
- 提供键盘快捷键支持

### 5.3 可维护性要求

- 代码结构清晰，模块化设计
- 充分的代码注释和文档
- 单元测试覆盖率 > 80%
